<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <title>Ottaiqam</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>

      <script>
            function startConnect() {
                // Generate a random client ID
                clientID = "clientID_" + parseInt(Math.random() * 100);
            
                // Fetch the hostname/IP address and port number from the form
                username = document.getElementById("username").value;
                password = document.getElementById("password").value;
                host = document.getElementById("host").value;
                port = document.getElementById("port").value;
            
                // Print output for the user in the messages div
                document.getElementById("messages").innerHTML += '<span>Connecting to: ' + host + ' on port: ' + port + '</span><br/>';
                document.getElementById("messages").innerHTML += '<span>Using the following client value: ' + clientID + '</span><br/>';
              // Initialize new Paho client connection
                client = new Paho.MQTT.Client(host, Number(port), clientID);
                // Set callback handlers
                client.onConnectionLost = onConnectionLost;
                client.onMessageArrived = onMessageArrived;
            
                client.connect({userName : username,password : password,
                    onSuccess: onConnect,
                    onFailure: onFail
                               });
            }
            function onFail() {
                document.getElementById("messages").innerHTML += '<span>ERROR: Connection to: ' + host + ' on port: ' + port + ' failed.</span><br/>'
            }  
           let topic="brian.nguyen@abbindustrigymnasium.se/";
            // Called when the client connects
            function onConnect() {
                // Fetch the MQTT topic from the form
                topic +=document.getElementById("topic").value;
            console.log(topic);
                // Print output for the user in the messages div
                document.getElementById("messages").innerHTML += '<span>Subscribing to: ' + topic + '</span><br/>';
            
                // Subscribe to the requested topic
                 client.subscribe(topic);
                  message= new Paho.MQTT.Message("Hello World!");
                  message.destinationName=topic;
                  client.send(message);
            }
            function onSend() {
                // Fetch the MQTT topic from the form
                // Print output for the user in the messages div
               let message= document.getElementById("newMessage").value;
            console.log(message);
                  message= new Paho.MQTT.Message(message);
                  message.destinationName=topic;
                  client.send(message);
            }
            // Called when the client loses its connection
            function onConnectionLost(responseObject) {
                document.getElementById("messages").innerHTML += '<span>ERROR: Connection lost</span><br/>';
                if (responseObject.errorCode !== 0) {
                    document.getElementById("messages").innerHTML += '<span>ERROR: ' + responseObject.errorMessage + '</span><br/>';
                }
            }
            
            // Called when a message arrives
            function onMessageArrived(message) {
                console.log("onMessageArrived: " + message.payloadString);
                document.getElementById("messages").innerHTML += '<span>Topic: ' + message.destinationName + '  | ' + message.payloadString + '</span><br/>';
            }
            
            // Called when the disconnection button is pressed
            function startDisconnect() {
                client.disconnect();
                document.getElementById("messages").innerHTML += '<span>Disconnected</span><br/>';
            }

            function startCar() {
                document.getElementById("on-off").onclick = stopCar();
                document.getElementById("on-off").value = "Off";
                document.getElementById("messages").innerHTML += '<span>250</span><br/>';
                document.getElementById("on-off").style.box-shadow = rgb();
            }

            function stopCar() {
                document.getElementById("on-off").onclick = startCar();
                document.getElementById("on-off").value = "On";
                document.getElementById("messages").innerHTML += '<span>0</span><br/>';
            }
            </script>
            

    <style>
        body {
            background-color: rgb(23, 10, 16);
        }

        h1 {
            color: azure;
            text-align: center;
            font-size: 72px;
        }
        .user,.pass,.host,.port,.topic {
            color: azure;
        }

        label {
            display: block;
            font: 24px 'Fira Sans', sans-serif;
        }

        input,
        label {
            margin: 4px;
        }

        input {
            height: 32px;
            width: 400px;
            font-size: 24px;
            color: azure;
            background-color: rgb(46, 25, 35);
            border: 2px solid rgb(93, 37, 84);
            border-radius: 5px;
            
        }

        #on-off {
            background-color: rgb(146, 88, 116);
            width: 404px;
        }

        #connect-button:hover, #disconnect-button:hover, #on-off:hover {
            background-color: rgb(93, 37, 84);
        }

        #on-off:active {
            background-color: rgb(46, 25, 35);
        }

        #connect-button, #disconnect-button {
            background-color: rgb(146, 88, 116);
            width: 196px;
        }
        </style>
    </head>
   <body>
      <div class="wrapper">
         <h1>Ottaiqam</h1>
         <form id="connection-information-form">
            <div class="user">
                <label for="username">Username</label>
                <input id="username" placeholder="Enter username" typ="text" name="username" value="">
            </div>

            <div class="pass">
                <label for="username">Password</label>
                <input id="password" placeholder="Enter password" type="password" name="password" value="">
            </div>

            <div class="host">
                <label for="host">Host</label> 
                <input id="host" placeholder="Enter IP address or URL" type="text" name="host" value="maqiatto.com">
            </div>

            <div class="port">
                <label for="port">Port</label> 
                <input id="port" placeholder="####" type="text" name="port" value="8883">
            </div>

            <div class="topic">
                <label for="topic">Topic</label> 
                <input id="topic" placeholder="Enter topic" type="text" name="topic" value="SR"><br>
            </div>
            <div>
                <input id="connect-button" type="button" onclick="startConnect()" value="Connect">
                <input id="disconnect-button" type="button" onclick="startDisconnect()" value="Disconnect"><br>
            </div>
            <div class="on-off-button">
                <input id="on-off" type="button" onclick="startCar()" value="On")>
            </div>
         </form>
         <div id="messages"></div>
      </div>
   </body>
</html>
